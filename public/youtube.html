<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HERA VIP</title>
    <style>
        body { background: #000; color: #0f0; font-family: monospace; padding: 5px; margin: 0; text-align: center; }
        .search-box { display: flex; gap: 2px; margin-bottom: 5px; }
        input { flex: 1; padding: 5px; background: #222; color: #fff; border: 1px solid #0f0; }
        button { background: #050; color: #fff; border: 1px solid #0f0; font-weight: bold; cursor: pointer; }
        .btn-history { background: #550; width: 100%; margin-bottom: 5px; }

        .video-item { 
            border-bottom: 1px solid #333; padding: 5px 0; display: flex; gap: 5px; text-align: left;
        }
        img { width: 70px; height: 50px; object-fit: cover; border: 1px solid #333; }
        .info { flex: 1; overflow: hidden; }
        .title { font-size: 13px; color: white; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; display: block; }
        .meta { font-size: 11px; color: #888; }
        
        .btn-group { display: flex; gap: 2px; margin-top: 3px; }
        .btn-dl { flex: 1; font-size: 10px; padding: 4px; text-align: center; text-decoration: none; color: #000; font-weight: bold; }
        .btn-sumo { background: #fa0; } 
        .btn-hera { background: #0ff; }
    </style>
</head>
<body>

    <div class="search-box">
        <input type="text" id="searchInput" placeholder="T√¨m video..." onkeypress="if(event.key==='Enter') doSearch()">
        <button onclick="doSearch()">T√åM</button>
    </div>
    
    <button class="btn-history" onclick="loadHistory()">üïí XEM L·ªäCH S·ª¨ ƒê√É T·∫¢I</button>

    <div id="results">
        <div style="text-align:center; color:#555; margin-top:20px;">
            Nh·∫≠p t√™n r·ªìi b·∫•m T√åM<br>ho·∫∑c b·∫•m Xem L·ªãch S·ª≠
        </div>
    </div>

    <script>
        // H√†m render danh s√°ch video ra m√†n h√¨nh
        function renderVideos(list) {
            let html = '';
            list.forEach(v => {
                html += `
                <div class="video-item">
                    <img src="${v.thumbnail}">
                    <div class="info">
                        <span class="title">${v.title}</span>
                        <div class="meta">‚è± ${v.duration}</div>
                        <div class="btn-group">
                            <a href="/download?id=${v.id}&mode=sumo" class="btn-dl btn-sumo">SUMO (3GP)</a>
                            <a href="/download?id=${v.id}&mode=hera" class="btn-dl btn-hera">HERA (MP4)</a>
                        </div>
                        <a href="/download?id=${v.id}&mode=direct" class="btn-dl" style="background:#0b0; margin-top:2px;">üöÄ T·∫¢I NHANH</a>
                    </div>
                </div>`;
            });
            document.getElementById('results').innerHTML = html;
        }

        async function doSearch() {
            const q = document.getElementById('searchInput').value;
            if(!q) return;
            document.getElementById('results').innerHTML = '<p style="color:yellow">ƒêang t√¨m...</p>';
            try {
                const res = await fetch('/api/search?q=' + encodeURIComponent(q));
                const data = await res.json();
                if (data.error) {
                    document.getElementById('results').innerHTML = '<p style="color:red">'+data.error+'</p>';
                } else {
                    renderVideos(data);
                }
            } catch (e) {
                document.getElementById('results').innerHTML = '<p style="color:red">L·ªói m·∫°ng: '+e.message+'</p>';
            }
        }

        async function loadHistory() {
            document.getElementById('results').innerHTML = '<p style="color:yellow">ƒêang t·∫£i l·ªãch s·ª≠...</p>';
            try {
                const res = await fetch('/api/history');
                const data = await res.json();
                if(data.length === 0) {
                    document.getElementById('results').innerHTML = '<p>Ch∆∞a c√≥ l·ªãch s·ª≠. H√£y t·∫£i th·ª≠ 1 video!</p>';
                } else {
                    renderVideos(data);
                }
            } catch (e) {
                document.getElementById('results').innerHTML = '<p style="color:red">L·ªói xem l·ªãch s·ª≠</p>';
            }
        }
    </script>
</body>
</html>