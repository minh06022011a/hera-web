<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hera S9 - Super Search</title>
    <style>
        body { background-color: #121212; color: #e0e0e0; font-family: monospace; padding: 10px; margin: 0; }
        
        /* SEARCH BOX */
        .search-box { position: sticky; top: 0; background: #121212; padding: 10px 0; z-index: 100; border-bottom: 1px solid #333; display: flex; gap: 10px; }
        input[type="text"] { flex: 1; background: #2c2c2c; border: 1px solid #444; color: #fff; padding: 12px; border-radius: 4px; font-size: 16px; }
        .btn-search { background: #b71c1c; color: #fff; border: none; padding: 0 20px; font-weight: bold; border-radius: 4px; cursor: pointer; }
        
        /* RESULT LIST */
        .results-grid { display: grid; grid-template-columns: 1fr; gap: 15px; margin-top: 15px; padding-bottom: 80px; }
        .video-card { display: flex; gap: 10px; background: #1e1e1e; padding: 10px; border-radius: 8px; cursor: pointer; border: 1px solid #333; }
        .video-card:active { background: #333; }
        .thumb { width: 120px; height: 68px; object-fit: cover; border-radius: 4px; flex-shrink: 0; }
        .info { overflow: hidden; }
        .title { font-weight: bold; font-size: 14px; margin-bottom: 5px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        .meta { font-size: 12px; color: #aaa; }

        /* TIME SELECTOR POPUP */
        .time-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 200; align-items: center; justify-content: center; flex-direction: column; }
        .modal-content { background: #1e1e1e; padding: 20px; border-radius: 8px; border: 1px solid #ff0000; width: 90%; max-width: 400px; text-align: center; }
        .time-inputs { display: flex; gap: 10px; justify-content: center; margin: 20px 0; }
        .time-inputs input { width: 60px; text-align: center; background: #333; color: #fff; border: 1px solid #555; padding: 10px; border-radius: 4px; }
        
        .btn-group { display: flex; gap: 10px; margin-top: 10px; }
        .btn-play { flex: 1; padding: 15px; background: #00c853; color: #fff; border: none; font-weight: bold; border-radius: 4px; cursor: pointer; }
        .btn-app { flex: 1; padding: 15px; background: #2962ff; color: #fff; border: none; font-weight: bold; border-radius: 4px; cursor: pointer; }
        .btn-close { background: transparent; border: none; color: #888; margin-top: 15px; cursor: pointer; text-decoration: underline; }

        /* PLAYER OVERLAY */
        .player-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 300; }
        .player-frame { width: 100%; height: 100%; }
        .btn-back { position: absolute; top: 10px; left: 10px; background: rgba(0,0,0,0.7); color: #fff; padding: 5px 15px; border: 1px solid #fff; z-index: 301; cursor: pointer; }
    </style>
</head>
<body>

    <div class="search-box">
        <input type="text" id="searchInput" placeholder="Nhập tên video..." onkeypress="if(event.key==='Enter') doSearch()">
        <button class="btn-search" onclick="doSearch()">TÌM</button>
    </div>

    <div id="status" style="text-align:center; margin-top:20px; color:#888;">Nhập từ khóa để tìm...</div>
    <div class="results-grid" id="resultsArea"></div>

    <div id="timeModal" class="time-modal">
        <div class="modal-content">
            <h3 id="selectedTitle" style="color: #ff5252; margin:0 0 10px 0;"></h3>
            <div style="font-size: 13px; color: #aaa;">Muốn xem từ phút bao nhiêu?</div>
            
            <div class="time-inputs">
                <input type="number" id="h" placeholder="Giờ" value="0" min="0">
                <input type="number" id="m" placeholder="Phút" value="0" min="0">
                <input type="number" id="s" placeholder="Giây" value="0" min="0">
            </div>

            <div class="btn-group">
                <button class="btn-play" onclick="playWeb()">XEM TRÊN WEB</button>
                <button class="btn-app" onclick="openApp()">MỞ BẰNG APP</button>
            </div>
            <button class="btn-close" onclick="closeModal()">Hủy bỏ</button>
        </div>
    </div>

    <div id="playerOverlay" class="player-overlay">
        <button class="btn-back" onclick="closePlayer()">QUAY LẠI TÌM KIẾM</button>
        <div id="playerContainer" style="width:100%; height:100%"></div>
    </div>

    <script>
        // DANH SÁCH SERVER DỰ PHÒNG (Cái này chết thì dùng cái kia)
        const API_MIRRORS = [
            "https://inv.tux.pizza/api/v1/search",
            "https://vid.puffyan.us/api/v1/search",
            "https://invidious.projectsegfau.lt/api/v1/search",
            "https://invidious.jing.rocks/api/v1/search"
        ];

        let currentVideoId = "";

        // Hàm thử lần lượt các API cho đến khi được thì thôi
        async function fetchWithFallback(query) {
            for (const domain of API_MIRRORS) {
                try {
                    console.log("Đang thử server:", domain);
                    const res = await fetch(`${domain}?q=${encodeURIComponent(query)}&type=video`);
                    if (res.ok) return await res.json();
                } catch (e) {
                    console.warn("Server lỗi:", domain);
                    continue; // Thử cái tiếp theo
                }
            }
            throw new Error("Tất cả server đều sập!");
        }

        async function doSearch() {
            const query = document.getElementById('searchInput').value.trim();
            if(!query) return;

            document.getElementById('status').innerText = "Đang quét dữ liệu (Đang thử nhiều server)...";
            document.getElementById('resultsArea').innerHTML = "";

            try {
                const data = await fetchWithFallback(query);

                if(!data || data.length === 0) {
                    document.getElementById('status').innerText = "Không tìm thấy gì.";
                    return;
                }
                document.getElementById('status').style.display = 'none';
                
                data.forEach(vid => {
                    const card = document.createElement('div');
                    card.className = 'video-card';
                    card.onclick = () => openTimeSelector(vid.videoId, vid.title);

                    let thumbUrl = vid.videoThumbnails && vid.videoThumbnails.length > 0 
                                   ? vid.videoThumbnails[1].url 
                                   : `https://i.ytimg.com/vi/${vid.videoId}/mqdefault.jpg`;

                    card.innerHTML = `
                        <img src="${thumbUrl}" class="thumb" onerror="this.src='https://i.ytimg.com/vi/${vid.videoId}/mqdefault.jpg'">
                        <div class="info">
                            <div class="title">${vid.title}</div>
                            <div class="meta">Kênh: ${vid.author}</div>
                        </div>
                    `;
                    document.getElementById('resultsArea').appendChild(card);
                });

            } catch (e) {
                document.getElementById('status').innerText = "Lỗi kết nối tất cả server! (Thử lại sau)";
            }
        }

        function openTimeSelector(vidId, title) {
            currentVideoId = vidId;
            document.getElementById('selectedTitle').innerText = title;
            document.getElementById('h').value = 0;
            document.getElementById('m').value = 0;
            document.getElementById('s').value = 0;
            document.getElementById('timeModal').style.display = 'flex';
        }

        function closeModal() { document.getElementById('timeModal').style.display = 'none'; }

        function getSeconds() {
            const h = parseInt(document.getElementById('h').value) || 0;
            const m = parseInt(document.getElementById('m').value) || 0;
            const s = parseInt(document.getElementById('s').value) || 0;
            return (h * 3600) + (m * 60) + s;
        }

        // CÁCH 1: Xem trên Web (Embed)
        function playWeb() {
            const totalSeconds = getSeconds();
            const embedUrl = `https://www.youtube.com/embed/${currentVideoId}?start=${totalSeconds}&autoplay=1&rel=0`;
            
            document.getElementById('playerContainer').innerHTML = `<iframe src="${embedUrl}" class="player-frame" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>`;
            document.getElementById('timeModal').style.display = 'none';
            document.getElementById('playerOverlay').style.display = 'block';
        }

        // CÁCH 2: Ép mở App Youtube (Commit "Them nut ep mo App")
        function openApp() {
            const totalSeconds = getSeconds();
            // Lệnh gọi thẳng App Youtube trên Android
            window.location.href = `vnd.youtube://${currentVideoId}?t=${totalSeconds}`;
        }

        function closePlayer() {
            document.getElementById('playerContainer').innerHTML = ""; 
            document.getElementById('playerOverlay').style.display = 'none';
        }
    </script>
</body>
</html>